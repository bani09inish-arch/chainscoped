<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChainScope - Ethereum Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-white">
    <div class="bg-gray-900 border-b border-gray-800 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                <h1 class="text-2xl font-bold text-blue-400">ChainScope</h1>
                <span class="px-2 py-1 bg-blue-900/30 text-blue-400 text-xs rounded">Powered by GoldRush</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                <span class="text-sm text-gray-400">Ethereum Mainnet</span>
            </div>
        </div>
    </div>

    <div class="p-6 max-w-6xl mx-auto space-y-6">
        <div class="bg-gray-900 border border-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Portfolio Tracker</h2>
            <div class="flex gap-3">
                <input id="ethAddress" type="text" placeholder="Enter Ethereum address (0x...)" class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500" value="vitalik.eth"/>
                <button onclick="loadEthPortfolio()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium">Load</button>
            </div>
            <div class="mt-3 flex gap-2">
                <button onclick="document.getElementById('ethAddress').value='vitalik.eth';loadEthPortfolio()" class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded">Vitalik</button>
                <button onclick="document.getElementById('ethAddress').value='0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045';loadEthPortfolio()" class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded">Sample Wallet</button>
            </div>
        </div>

        <div id="portfolioResults" class="hidden bg-gray-900 border border-gray-800 rounded-lg p-6">
            <h3 class="text-lg font-bold mb-4">Token Holdings</h3>
            <div id="portfolioData"></div>
        </div>

        <div class="bg-gray-900 border border-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">Recent Transactions</h2>
            <div id="txData"></div>
        </div>
    </div>

    <script>
        const API_KEY = 'cqt_rQrhHxD6VkKyQGCWggHJHB4DmjbD';

        async function loadEthPortfolio() {
            const address = document.getElementById('ethAddress').value.trim();
            if (!address) return alert('Enter an address');

            document.getElementById('portfolioResults').classList.remove('hidden');
            document.getElementById('portfolioData').innerHTML = '<p class="text-gray-400">Loading...</p>';

            try {
                const response = await fetch(
                    `https://api.covalenthq.com/v1/eth-mainnet/address/${address}/balances_v2/?key=${API_KEY}`,
                    { headers: { 'Authorization': `Bearer ${API_KEY}` }}
                );

                const data = await response.json();
                
                if (!data.data?.items) {
                    document.getElementById('portfolioData').innerHTML = '<p class="text-red-400">Error loading data</p>';
                    return;
                }

                const tokens = data.data.items.filter(t => parseFloat(t.balance) > 0).slice(0, 10);
                
                let html = '<div class="space-y-3">';
                tokens.forEach(token => {
                    const balance = parseFloat(token.balance) / Math.pow(10, token.contract_decimals);
                    const value = token.quote || 0;
                    
                    html += `
                        <div class="flex items-center justify-between p-4 bg-gray-800 rounded-lg">
                            <div>
                                <p class="font-medium text-white">${token.contract_ticker_symbol}</p>
                                <p class="text-sm text-gray-400">${token.contract_name}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-mono text-white">${balance.toFixed(4)}</p>
                                <p class="text-sm text-blue-400">$${value.toFixed(2)}</p>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';

                document.getElementById('portfolioData').innerHTML = html;
                loadTransactions(address);
                
            } catch (error) {
                console.error(error);
                document.getElementById('portfolioData').innerHTML = '<p class="text-red-400">Error loading portfolio</p>';
            }
        }

        async function loadTransactions(address) {
            document.getElementById('txData').innerHTML = '<p class="text-gray-400">Loading transactions...</p>';

            try {
                const response = await fetch(
                    `https://api.covalenthq.com/v1/eth-mainnet/address/${address}/transactions_v3/?key=${API_KEY}`,
                    { headers: { 'Authorization': `Bearer ${API_KEY}` }}
                );

                const data = await response.json();
                
                if (!data.data?.items) {
                    document.getElementById('txData').innerHTML = '<p class="text-gray-400">No transactions found</p>';
                    return;
                }

                const txs = data.data.items.slice(0, 10);
                let html = '<div class="space-y-2">';

                txs.forEach(tx => {
                    const value = parseFloat(tx.value) / 1e18;
                    const time = new Date(tx.block_signed_at).toLocaleString();
                    
                    html += `
                        <div class="p-3 bg-gray-800 rounded-lg">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gray-400 font-mono">${tx.tx_hash.slice(0, 10)}...</span>
                                <span class="font-mono text-blue-400">${value.toFixed(4)} ETH</span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">${time}</div>
                        </div>
                    `;
                });
                html += '</div>';

                document.getElementById('txData').innerHTML = html;

            } catch (error) {
                console.error(error);
                document.getElementById('txData').innerHTML = '<p class="text-red-400">Error loading transactions</p>';
            }
        }

        // Auto-load Vitalik on page load
        window.onload = () => loadEthPortfolio();
    </script>
</body>
</html>
